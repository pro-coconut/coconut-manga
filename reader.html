<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="comic-title">Đang tải...</title>
<link rel="icon" href="data:,">
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #fff;
    scroll-behavior: smooth;
  }

  header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
  }

  header h1 {
    font-size: 1.4em;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  header button {
    background: #e74c3c;
    border: none;
    color: #fff;
    padding: 8px 15px;
    border-radius: 25px;
    font-size: 1em;
    cursor: pointer;
    transition: 0.3s;
  }

  header button:hover {
    background: #c0392b;
  }

  #pages {
    padding: 90px 10px 30px; /* padding-top đủ cho header */
    max-width: 900px;
    margin: 0 auto;
  }

  .chapter {
    margin-bottom: 50px;
    text-align: center;
  }

  .chapter h2 {
    margin-bottom: 20px;
    font-size: 1.5em;
    color: #f39c12;
    text-shadow: 0 2px 5px rgba(0,0,0,0.5);
  }

  .chapter img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto 15px;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    transition: transform 0.3s;
  }

  .chapter img:hover {
    transform: scale(1.02);
  }

  .page-info {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding: 10px 20px;
    border-radius: 30px;
    font-weight: bold;
    z-index: 1000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>

<header>
  <h1 id="comic-title">Đang tải...</h1>
  <button onclick="history.back()">← Quay lại</button>
</header>

<div id="pages"></div>

<div class="page-info" id="page-info">0 / 0</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const storyId = urlParams.get('id');

if (!storyId) {
  document.body.innerHTML = "<h1 style='text-align:center;margin-top:50px'>Không tìm thấy truyện!</h1>";
}

fetch('stories.json')
  .then(r => r.json())
  .then(data => {
    const story = data.find(s => s.id === storyId);
    if (!story) throw new Error("Truyện không tồn tại");

    document.getElementById('comic-title').textContent = story.title;
    const container = document.getElementById('pages');

    story.chapters.forEach((chap) => {
      const chapDiv = document.createElement('div');
      chapDiv.className = 'chapter';
      chapDiv.innerHTML = `<h2>${chap.name}</h2>`;

      chap.images.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.loading = "lazy";
        img.alt = "page";
        chapDiv.appendChild(img);
      });

      container.appendChild(chapDiv);
    });

    // Cập nhật số trang
    const total = container.querySelectorAll('img').length;
    const pageInfo = document.getElementById('page-info');
    pageInfo.textContent = `1 / ${total}`;

    window.addEventListener('scroll', () => {
      const imgs = container.querySelectorAll('img');
      let current = 1;
      imgs.forEach((img, i) => {
        if (img.getBoundingClientRect().top < window.innerHeight / 2) current = i + 1;
      });
      pageInfo.textContent = `${current} / ${total}`;
    });
  })
  .catch(err => {
    document.body.innerHTML = `<h1 style='text-align:center;margin-top:50px'>Lỗi: ${err.message}</h1>`;
  });
</script>

</body>
</html>
